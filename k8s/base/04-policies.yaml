---
# Network Policy: restrict pod-to-pod traffic
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: timesheet-network-policy
  namespace: timesheet
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    # Allow ingress from within namespace
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: timesheet
    # Allow ingress from nginx-ingress
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: ingress-nginx
  egress:
    # Allow all egress (DNS, internet)
    - {}

---
# PodDisruptionBudget for backend
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: backend-pdb
  namespace: timesheet
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: backend

---
# PodDisruptionBudget for frontend
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: frontend-pdb
  namespace: timesheet
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: frontend
